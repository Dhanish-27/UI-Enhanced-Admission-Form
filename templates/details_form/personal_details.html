{% extends 'details_form/Created_base.html' %}

{% block title %}Personal Details{% endblock %}

{% block content %}
{% include "details_form/tracker.html" %}
<div class="col-span-1 lg:col-span-9">
  <!-- Messages -->
  {% if messages %}
  <div class="mb-6 space-y-2">
    {% for message in messages %}
    <div
      class="p-4 rounded-lg text-sm font-medium {% if message.tags == 'error' %}bg-red-50 text-red-600{% elif message.tags == 'success' %}bg-green-50 text-green-600{% else %}bg-blue-50 text-blue-600{% endif %}">
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Content Block -->
  <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 md:p-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com"></script>
<form method="post" enctype="multipart/form-data" action="{% url 'personal_details' %}{% if pk %}?pk={{ pk }}{% endif %}" id="personalForm">
  {% csrf_token %}
  <input type="hidden" name="pk" value="{% if admission %}{{ admission.pk }}{% endif %}">

  <!-- Student Details -->
  <div class="card">
    <h2>1. Student Details</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label>Student Name:<span class="text-red-600">*</span></label>
        <input type="text" name="student_name" value="{% if admission %}{{ admission.student_name }}{% endif %}" placeholder="Enter your full name" required class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="student_name_error"></span>
      </div>
      <div>
        <label>Email:</label>
        <input type="email" name="email" value="{% if admission %}{{ admission.email }}{% endif %}" placeholder="Enter your email" required class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="email_error"></span>
      </div>

      <div>
        <label>Student Mobile:<span class="text-red-600">*</span></label>
        <input type="tel" name="student_mobile" value="{% if admission %}{{ admission.student_mobile }}{% endif %}" placeholder="Enter student mobile number" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="student_mobile_error"></span>
      </div>
      <div>
        <label>Father's Name:<span class="text-red-600">*</span></label>
        <input type="text" name="father_name" value="{% if admission %}{{ admission.father_name }}{% endif %}" placeholder="Enter your full name" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="father_name_error"></span>
      </div>

      <div>
        <label>Father Mobile:</label>
        <input type="tel" name="father_mobile" value="{% if admission %}{{ admission.father_mobile }}{% endif %}" placeholder="Enter father mobile number" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="father_mobile_error"></span>
      </div>
      <div>
        <label>Mother's Name:<span class="text-red-600">*</span></label>
        <input type="text" name="mother_name" value="{% if admission %}{{ admission.mother_name }}{% endif %}" placeholder="Enter your full name" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="mother_name_error"></span>
      </div>

      <div>
        <label>Mother Mobile:</label>
        <input type="tel" name="mother_mobile" value="{% if admission %}{{ admission.mother_mobile }}{% endif %}" placeholder="Enter mother mobile number" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="mother_mobile_error"></span>
      </div>
      <div>
        <label>Gaurdian's Name:</label>
        <input type="text" name="guardian_name" value="{% if admission %}{{ admission.guardian_name }}{% endif %}" placeholder="Enter your full name" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="guardian_name_error"></span>
      </div>

      <div>
        <label>Guardian Mobile:</label>
        <input type="tel" name="guardian_mobile" value="{% if admission %}{{ admission.guardian_mobile }}{% endif %}" placeholder="Enter guardian mobile number" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="guardian_mobile_error"></span>
      </div>
      <div>
        <label>Register Number:</label>
        <input type="text" name="register_number" value="{% if admission %}{{ admission.register_number }}{% endif %}" placeholder="Enter register number" required class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="register_number_error"></span>
      </div>

      <div>
        <label>EMIS Number:</label>
        <input type="text" name="umis_number" value="{% if admission %}{{ admission.umis_number }}{% endif %}" placeholder="Enter register number" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="umis_number_error"></span>
      </div>
      <div>
        <label>Date of Birth:<span class="text-red-600">*</span></label>
        <input type="date" name="dob" value="{% if admission %}{{ admission.dob|date:'Y-m-d' }}{% endif %}" required class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="dob_error"></span>
      </div>

      <div>
        <label>Gender:<span class="text-red-600">*</span></label>
        <select name="gender" required class="w-full border border-gray-300 rounded px-2 py-1">
          <option value="">Select Gender</option>
          <option {% if admission and admission.gender == 'Male' %}selected{% endif %}>Male</option>
          <option {% if admission and admission.gender == 'Female' %}selected{% endif %}>Female</option>
          <option {% if admission and admission.gender == 'Others' %}selected{% endif %}>Others</option>
        </select>
        <span class="error-message" id="gender_error"></span>
      </div>
      <div>
        <label>Country:<span class="text-red-600">*</span></label>
        <select name="country" id="country" required class="w-full border border-gray-300 rounded px-2 py-1">
          <option value="">Select Country</option>
          <option value="India" {% if admission and admission.country == 'India' %}selected{% endif %}>India</option>
          <option value="Other" {% if admission and admission.country == 'Other' %}selected{% endif %}>Other</option>
        </select>
        <span class="error-message" id="country_error"></span>
      </div>

      <div>
        <label>State:<span class="text-red-600">*</span></label>
        <select name="state" id="state_dropdown" required class="w-full border border-gray-300 rounded px-2 py-1">
          <option value="">Select State</option>
          {% comment %} Add states options here. Possible to add dynamically later. {% endcomment %}
          <option value="Andhra Pradesh" {% if admission and admission.state == 'Andhra Pradesh' %}selected{% endif %}>Andhra Pradesh</option>
          <option value="Arunachal Pradesh" {% if admission and admission.state == 'Arunachal Pradesh' %}selected{% endif %}>Arunachal Pradesh</option>
          <option value="Assam" {% if admission and admission.state == 'Assam' %}selected{% endif %}>Assam</option>
          <option value="Bihar" {% if admission and admission.state == 'Bihar' %}selected{% endif %}>Bihar</option>
          <option value="Chhattisgarh" {% if admission and admission.state == 'Chhattisgarh' %}selected{% endif %}>Chhattisgarh</option>
          <option value="Goa" {% if admission and admission.state == 'Goa' %}selected{% endif %}>Goa</option>
          <option value="Gujarat" {% if admission and admission.state == 'Gujarat' %}selected{% endif %}>Gujarat</option>
          <option value="Haryana" {% if admission and admission.state == 'Haryana' %}selected{% endif %}>Haryana</option>
          <option value="Himachal Pradesh" {% if admission and admission.state == 'Himachal Pradesh' %}selected{% endif %}>Himachal Pradesh</option>
          <option value="Jharkhand" {% if admission and admission.state == 'Jharkhand' %}selected{% endif %}>Jharkhand</option>
          <option value="Karnataka" {% if admission and admission.state == 'Karnataka' %}selected{% endif %}>Karnataka</option>
          <option value="Kerala" {% if admission and admission.state == 'Kerala' %}selected{% endif %}>Kerala</option>
          <option value="Madhya Pradesh" {% if admission and admission.state == 'Madhya Pradesh' %}selected{% endif %}>Madhya Pradesh</option>
          <option value="Maharashtra" {% if admission and admission.state == 'Maharashtra' %}selected{% endif %}>Maharashtra</option>
          <option value="Manipur" {% if admission and admission.state == 'Manipur' %}selected{% endif %}>Manipur</option>
          <option value="Meghalaya" {% if admission and admission.state == 'Meghalaya' %}selected{% endif %}>Meghalaya</option>
          <option value="Mizoram" {% if admission and admission.state == 'Mizoram' %}selected{% endif %}>Mizoram</option>
          <option value="Nagaland" {% if admission and admission.state == 'Nagaland' %}selected{% endif %}>Nagaland</option>
          <option value="Odisha" {% if admission and admission.state == 'Odisha' %}selected{% endif %}>Odisha</option>
          <option value="Punjab" {% if admission and admission.state == 'Punjab' %}selected{% endif %}>Punjab</option>
          <option value="Rajasthan" {% if admission and admission.state == 'Rajasthan' %}selected{% endif %}>Rajasthan</option>
          <option value="Sikkim" {% if admission and admission.state == 'Sikkim' %}selected{% endif %}>Sikkim</option>
          <option value="Tamil Nadu" {% if admission and admission.state == 'Tamil Nadu' %}selected{% endif %}>Tamil Nadu</option>
          <option value="Telangana" {% if admission and admission.state == 'Telangana' %}selected{% endif %}>Telangana</option>
          <option value="Tripura" {% if admission and admission.state == 'Tripura' %}selected{% endif %}>Tripura</option>
          <option value="Uttar Pradesh" {% if admission and admission.state == 'Uttar Pradesh' %}selected{% endif %}>Uttar Pradesh</option>
          <option value="Uttarakhand" {% if admission and admission.state == 'Uttarakhand' %}selected{% endif %}>Uttarakhand</option>
          <option value="West Bengal" {% if admission and admission.state == 'West Bengal' %}selected{% endif %}>West Bengal</option>
          <option value="Other" {% if admission and admission.state == 'Other' %}selected{% endif %}>Other</option>
        </select>
        <input type="text" name="state_others" id="state_input" placeholder="Enter state" style="display:none;" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="state_error"></span>
      </div>

      <div>
        <label>District:<span class="text-red-600">*</span></label>
        <select name="district" id="district_dropdown" required class="w-full border border-gray-300 rounded px-2 py-1">
          <option value="">Select District</option>
          {% comment %} Add districts options here. Possible to add dynamically later. {% endcomment %}
          <option value="Chennai" {% if admission and admission.district == 'Chennai' %}selected{% endif %}>Chennai</option>
          <option value="Other" {% if admission and admission.district == 'Other' %}selected{% endif %}>Other</option>
        </select>
        <input type="text" name="district_others" id="district_input" placeholder="Enter district" style="display:none;" class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="district_error"></span>
      </div>

      <div>
        <label>Address:<span class="text-red-600">*</span></label>
        <input type="text" name="address" value="{% if admission %}{{ admission.address }}{% endif %}" placeholder="Enter address" required class="w-full border border-gray-300 rounded px-2 py-1">
        <span class="error-message" id="address_error"></span>
      </div>
      <div>
        <label>Community:<span class="text-red-600">*</span></label>
        <select name="community" class="w-full border border-gray-300 rounded px-2 py-1">
          <option value="">Select Community</option>
          <option value="OC" {% if admission and admission.community == 'OC' %}selected{% endif %}>Open Competition (OC)</option>
          <option value="BC" {% if admission and admission.community == 'BC' %}selected{% endif %}>Backward Class (BC)</option>
          <option value="MBC" {% if admission and admission.community == 'MBC' %}selected{% endif %}>Most Backward Class (MBC)</option>
          <option value="DNC" {% if admission and admission.community == 'DNC' %}selected{% endif %}>Denotified Communities (DNC)</option>
          <option value="BCM" {% if admission and admission.community == 'BCM' %}selected{% endif %}>Backward Class (Muslim) (BCM)</option>
          <option value="SC" {% if admission and admission.community == 'SC' %}selected{% endif %}>Scheduled Caste (SC)</option>
          <option value="SCA" {% if admission and admission.community == 'SCA' %}selected{% endif %}>Scheduled Caste (Arunthathiyar) (SCA)</option>
          <option value="ST" {% if admission and admission.community == 'ST' %}selected{% endif %}>Scheduled Tribe (ST)</option>
        </select>
        <span class="error-message" id="community_error"></span>
      </div>
    </div>
    <div class="text-center mt-5">
      <button type="submit" class="bg-orange-600 text-white px-6 py-2 rounded hover:bg-orange-700">Next</button>
    </div>
  </div>
</form>
  </div>
</div>

<script>
  const statesDistricts = {
    "Andhra Pradesh": ["Anakapalli", "Anantapur", "Annamayya", "Bapatla", "Chittoor", "East Godavari", "Eluru", "Guntur", "Kadapa", "Kakinada", "Konaseema", "Krishna", "Kurnool", "Nandyal", "Nellore", "Palnadu", "Prakasam", "Sri Balaji", "Sri Sathya Sai", "Srikakulam", "Tirupati", "Visakhapatnam", "Vizianagaram", "West Godavari"],
    "Arunachal Pradesh": ["Tawang", "West Kameng", "East Kameng", "Papum Pare", "Kurung Kumey", "Kra Daadi", "Lower Subansiri", "Upper Subansiri", "West Siang", "East Siang", "Upper Siang", "Lower Dibang Valley", "Dibang Valley", "Lohit", "Namsai", "Changlang", "Tirap", "Longding"],
    "Assam": ["Baksa", "Barpeta", "Biswanath", "Bongaigaon", "Cachar", "Charaideo", "Chirang", "Darrang", "Dhemaji", "Dhubri", "Dibrugarh", "Dima Hasao", "Goalpara", "Golaghat", "Hailakandi", "Hojai", "Jorhat", "Kamrup", "Kamrup Metropolitan", "Karbi Anglong", "Karimganj", "Kokrajhar", "Lakhimpur", "Majuli", "Morigaon", "Nagaon", "Nalbari", "Sivasagar", "Sonitpur", "South Salmara", "Tinsukia", "Udalguri", "West Karbi Anglong"],
    "Bihar": ["Araria", "Arwal", "Aurangabad", "Banka", "Begusarai", "Bhagalpur", "Bhojpur", "Buxar", "Darbhanga", "East Champaran", "Gaya", "Gopalganj", "Jamui", "Jehanabad", "Katihar", "Khagaria", "Kishanganj", "Lakhisarai", "Madhepura", "Madhubani", "Munger", "Muzaffarpur", "Nalanda", "Nawada", "Patna", "Purnia", "Rohtas", "Saharsa", "Samastipur", "Saran", "Sheikhpura", "Sheohar", "Sitamarhi", "Siwan", "Supaul", "Vaishali", "West Champaran"],
    "Chhattisgarh": ["Balod", "Baloda Bazar", "Balrampur", "Bastar", "Bemetara", "Bijapur", "Bilaspur", "Dantewada", "Dhamtari", "Durg", "Gariaband", "Gaurela-Pendra-Marwahi", "Janjgir-Champa", "Jashpur", "Kabirdham", "Kanker", "Kondagaon", "Korba", "Korea", "Mahasamund", "Mungeli", "Narayanpur", "Raigarh", "Raipur", "Rajnandgaon", "Sukma", "Surajpur", "Surguja"],
    "Goa": ["North Goa", "South Goa"],
    "Gujarat": ["Ahmedabad", "Amreli", "Anand", "Aravalli", "Banaskantha", "Bharuch", "Bhavnagar", "Botad", "Chhota Udepur", "Dahod", "Dang", "Devbhoomi Dwarka", "Gandhinagar", "Gir Somnath", "Jamnagar", "Junagadh", "Kheda", "Kutch", "Mahisagar", "Mehsana", "Morbi", "Narmada", "Navsari", "Panchmahal", "Patan", "Porbandar", "Rajkot", "Sabarkantha", "Surat", "Surendranagar", "Tapi", "Vadodara", "Valsad"],
    "Haryana": ["Ambala", "Bhiwani", "Charkhi Dadri", "Faridabad", "Fatehabad", "Gurugram", "Hisar", "Jhajjar", "Jind", "Kaithal", "Karnal", "Kurukshetra", "Mahendragarh", "Nuh", "Palwal", "Panchkula", "Panipat", "Rewari", "Rohtak", "Sirsa", "Sonipat", "Yamunanagar"],
    "Himachal Pradesh": ["Bilaspur", "Chamba", "Hamirpur", "Kangra", "Kinnaur", "Kullu", "Lahaul and Spiti", "Mandi", "Shimla", "Sirmaur", "Solan", "Una"],
    "Jharkhand": ["Bokaro", "Chatra", "Deoghar", "Dhanbad", "Dumka", "East Singhbhum", "Garhwa", "Giridih", "Godda", "Gumla", "Hazaribagh", "Jamtara", "Khunti", "Koderma", "Latehar", "Lohardaga", "Pakur", "Palamu", "Ramgarh", "Ranchi", "Sahebganj", "Saraikela", "Simdega", "West Singhbhum"],
    "Karnataka": ["Bagalkot", "Bangalore Rural", "Bangalore Urban", "Belagavi", "Bellary", "Bidar", "Chamarajanagar", "Chikballapur", "Chikkamagaluru", "Chitradurga", "Dakshina Kannada", "Davanagere", "Dharwad", "Gadag", "Hassan", "Haveri", "Kalaburagi", "Kodagu", "Kolar", "Koppal", "Mandya", "Mysore", "Raichur", "Ramanagara", "Shivamogga", "Tumakuru", "Udupi", "Uttara Kannada", "Vijayanagara", "Vijayapura", "Yadgir"],
    "Kerala": ["Alappuzha", "Ernakulam", "Idukki", "Kannur", "Kasaragod", "Kollam", "Kottayam", "Kozhikode", "Malappuram", "Palakkad", "Pathanamthitta", "Thiruvananthapuram", "Thrissur", "Wayanad"],
    "Madhya Pradesh": ["Agar", "Alirajpur", "Anuppur", "Ashoknagar", "Balaghat", "Barwani", "Betul", "Bhind", "Bhopal", "Burhanpur", "Chhatarpur", "Chhindwara", "Damoh", "Datia", "Dewas", "Dhar", "Dindori", "Guna", "Gwalior", "Harda", "Hoshangabad", "Indore", "Jabalpur", "Jhabua", "Katni", "Khandwa", "Khargone", "Mandla", "Mandsaur", "Morena", "Narsinghpur", "Neemuch", "Panna", "Raisen", "Rajgarh", "Ratlam", "Rewa", "Sagar", "Satna", "Sehore", "Seoni", "Shahdol", "Shajapur", "Sheopur", "Shivpuri", "Sidhi", "Singrauli", "Tikamgarh", "Ujjain", "Umaria", "Vidisha"],
    "Maharashtra": ["Ahmednagar", "Akola", "Amravati", "Aurangabad", "Beed", "Bhandara", "Buldhana", "Chandrapur", "Dhule", "Gadchiroli", "Gondia", "Hingoli", "Jalgaon", "Jalna", "Kolhapur", "Latur", "Mumbai City", "Mumbai Suburban", "Nagpur", "Nanded", "Nandurbar", "Nashik", "Osmanabad", "Palghar", "Parbhani", "Pune", "Raigad", "Ratnagiri", "Sangli", "Satara", "Sindhudurg", "Solapur", "Thane", "Wardha", "Washim", "Yavatmal"],
    "Manipur": ["Bishnupur", "Chandel", "Churachandpur", "Imphal East", "Imphal West", "Jiribam", "Kakching", "Kamjong", "Kangpokpi", "Noney", "Pherzawl", "Senapati", "Tamenglong", "Tengnoupal", "Thoubal", "Ukhrul"],
    "Meghalaya": ["East Garo Hills", "West Garo Hills", "North Garo Hills", "South Garo Hills", "South West Garo Hills", "East Khasi Hills", "West Khasi Hills", "South West Khasi Hills", "Eastern West Khasi Hills", "Ri-Bhoi", "East Jaintia Hills", "West Jaintia Hills"],
    "Mizoram": ["Aizawl", "Champhai", "Kolasib", "Lawngtlai", "Lunglei", "Mamit", "Saitual", "Serchhip"],
    "Nagaland": ["Chümoukedima", "Dimapur", "Kiphire", "Kohima", "Longleng", "Mokokchung", "Mon", "Niuland", "Noklak", "Peren", "Phek", "Tuensang", "Tseminyu", "Wokha", "Zunheboto"],
    "Odisha": ["Angul", "Balangir", "Balasore", "Bargarh", "Bhadrak", "Boudh", "Cuttack", "Deogarh", "Dhenkanal", "Gajapati", "Ganjam", "Jagatsinghpur", "Jajpur", "Jharsuguda", "Kalahandi", "Kandhamal", "Kendrapara", "Kendujhar", "Khordha", "Koraput", "Malkangiri", "Mayurbhanj", "Nabarangpur", "Nayagarh", "Nuapada", "Puri", "Rayagada", "Sambalpur", "Subarnapur", "Sundargarh"],
    "Punjab": ["Amritsar", "Barnala", "Bathinda", "Faridkot", "Fatehgarh Sahib", "Fazilka", "Ferozepur", "Gurdaspur", "Hoshiarpur", "Jalandhar", "Kapurthala", "Ludhiana", "Mansa", "Moga", "Mohali", "Muktsar", "Pathankot", "Patiala", "Rupnagar", "Sangrur", "Shaheed Bhagat Singh Nagar", "Tarn Taran"],
    "Rajasthan": ["Ajmer", "Alwar", "Balotra", "Baran", "Barmer", "Bharatpur", "Bhilwara", "Bikaner", "Bundi", "Chittorgarh", "Dausa", "Dholpur", "Dungarpur", "Hanumangarh", "Jaipur", "Jaisalmer", "Jalore", "Jhalawar", "Jhunjhunu", "Jodhpur", "Karauli", "Kota", "Nagaur", "Pali", "Pratapgarh", "Rajsamand", "Sawai Madhopur", "Sikar", "Sirohi", "Sriganganagar", "Tonk", "Udaipur"],
    "Sikkim": ["Gangtok", "Gyalshing", "Mangan", "Namchi", "Pakyong", "Soreng"],
    "Tamil Nadu": ["Ariyalur", "Chengalpattu", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri", "Dindigul", "Erode", "Kallakurichi", "Kanchipuram", "Kanniyakumari", "Karur", "Krishnagiri", "Mayiladuthurai", "Nagapattinam", "Namakkal", "Nilgiris", "Perambalur", "Pudukkottai", "Ramanathapuram", "Ranipet", "Salem", "Sivagangai", "Tenkasi", "Thanjavur", "Theni", "Thoothukudi", "Tiruchirappalli", "Tirunelveli", "Tirupattur", "Tiruppur", "Tiruvallur", "Tiruvannamalai", "Tiruvarur", "Vellore", "Viluppuram", "Virudhunagar"],
    "Telangana": ["Adilabad", "Bhadradri Kothagudem", "Hanamkonda", "Hyderabad", "Jagtial", "Jangaon", "Jayashankar Bhupalpally", "Jogulamba Gadwal", "Kamareddy", "Karimnagar", "Khammam", "Komaram Bheem Asifabad", "Mahabubabad", "Mahabubnagar", "Mancherial", "Medak", "Medchal–Malkajgiri", "Mulugu", "Nagarkurnool", "Nalgonda", "Narayanpet", "Nirmal", "Nizamabad", "Peddapalli", "Rajanna Sircilla", "Ranga Reddy", "Sangareddy", "Siddipet", "Suryapet", "Vikarabad", "Wanaparthy", "Warangal", "Yadadri Bhuvanagiri"],
    "Tripura": ["Dhalai", "Gomati", "Khowai", "North Tripura", "Sepahijala", "South Tripura", "Unakoti", "West Tripura"],
    "Uttar Pradesh": ["Agra", "Aligarh", "Ambedkar Nagar", "Amethi", "Amroha", "Auraiya", "Ayodhya", "Azamgarh", "Baghpat", "Bahraich", "Ballia", "Balrampur", "Banda", "Barabanki", "Bareilly", "Basti", "Bhadohi", "Bijnor", "Budaun", "Bulandshahr", "Chandauli", "Chitrakoot", "Deoria", "Etah", "Etawah", "Ayodhya", "Farrukhabad", "Fatehpur", "Firozabad", "Gautam Buddha Nagar", "Ghaziabad", "Ghazipur", "Gonda", "Gorakhpur", "Hamirpur", "Hapur", "Hardoi", "Hathras", "Jalaun", "Jaunpur", "Jhansi", "Kannauj", "Kanpur Dehat", "Kanpur Nagar", "Kasganj", "Kaushambi", "Kheri", "Kushinagar", "Lalitpur", "Lucknow", "Maharajganj", "Mahoba", "Mainpuri", "Mathura", "Mau", "Meerut", "Mirzapur", "Moradabad", "Muzaffarnagar", "Pilibhit", "Pratapgarh", "Prayagraj", "Raebareli", "Rampur", "Saharanpur", "Sambhal", "Sant Kabir Nagar", "Shahjahanpur", "Shamli", "Shravasti", "Siddharthnagar", "Sitapur", "Sonbhadra", "Sultanpur", "Unnao", "Varanasi"],
    "Uttarakhand": ["Almora", "Bageshwar", "Chamoli", "Champawat", "Dehradun", "Haridwar", "Nainital", "Pauri Garhwal", "Pithoragarh", "Rudraprayag", "Tehri Garhwal", "Udham Singh Nagar", "Uttarkashi"],
    "West Bengal": ["Alipurduar", "Bankura", "Birbhum", "Cooch Behar", "Dakshin Dinajpur", "Darjeeling", "Hooghly", "Howrah", "Jalpaiguri", "Jhargram", "Kalimpong", "Kolkata", "Malda", "Murshidabad", "Nadia", "North 24 Parganas", "Paschim Bardhaman", "Paschim Medinipur", "Purba Bardhaman", "Purba Medinipur", "Purulia", "South 24 Parganas", "Uttar Dinajpur"]
  };

  function toggleCountryFields() {
    const countrySelect = document.getElementById('country');
    const stateDropdown = document.getElementById('state_dropdown');
    const stateInput = document.getElementById('state_input');
    const districtDropdown = document.getElementById('district_dropdown');
    const districtInput = document.getElementById('district_input');

    if (countrySelect.value === 'India') {
      // Show dropdowns
      stateDropdown.style.display = 'block';
      districtDropdown.style.display = 'block';
      // Hide input fields
      stateInput.style.display = 'none';
      districtInput.style.display = 'none';
      stateDropdown.required = true;
      districtDropdown.required = true;
      stateInput.required = false;
      districtInput.required = false;
    } else {
      // Show input fields
      stateInput.style.display = 'block';
      districtInput.style.display = 'block';
      // Hide dropdowns
      stateDropdown.style.display = 'none';
      districtDropdown.style.display = 'none';
      stateInput.required = true;
      districtInput.required = true;
      stateDropdown.required = false;
      districtDropdown.required = false;
    }
  }

  function populateDistricts() {
    const stateSelect = document.getElementById('state_dropdown');
    const districtSelect = document.getElementById('district_dropdown');
    const selectedState = stateSelect.value;

    // Clear current options
    districtSelect.innerHTML = '<option value="">Select District</option>';

    if (selectedState in statesDistricts) {
      statesDistricts[selectedState].forEach(district => {
        const option = document.createElement('option');
        option.value = district;
        option.textContent = district;
        districtSelect.appendChild(option);
      });
    }
  }

  document.getElementById('country').addEventListener('change', function () {
    toggleCountryFields();
  });

  document.getElementById('state_dropdown').addEventListener('change', function () {
    populateDistricts();
  });

  window.addEventListener('load', function () {
    toggleCountryFields();
    // Populate districts if initial state set
    const stateDropdown = document.getElementById('state_dropdown');
    if (stateDropdown.value) {
      populateDistricts();
      // Try to select district if admission.district is available
      const admissionDistrict = '{{ admission.district|escapejs }}';
      if (admissionDistrict) {
        const districtSelect = document.getElementById('district_dropdown');
        for (let option of districtSelect.options) {
          if (option.value === admissionDistrict) {
            option.selected = true;
            break;
          }
        }
      }
    }
  });

  document.getElementById('personalForm').addEventListener('submit', function (e) {
    let isValid = true;
    clearAllErrors();

    // Required fields
    const requiredFields = ['student_name', 'student_mobile', 'father_name', 'mother_name', 'register_number', 'dob', 'gender', 'country', 'state', 'district', 'address'];
    requiredFields.forEach(field => {
      const element = document.querySelector(`[name="${field}"]`);
      if (!element.value.trim()) {
        showError(field, 'This field is required');
        isValid = false;
      }
    });

    // Email validation
    const email = document.querySelector('[name="email"]').value;
    if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      showError('email', 'Please enter a valid email address');
      isValid = false;
    }

    // Mobile number validation (10 digits)
    const mobileFields = ['student_mobile', 'father_mobile', 'mother_mobile', 'guardian_mobile'];
    mobileFields.forEach(field => {
      const value = document.querySelector(`[name="${field}"]`).value;
      if (value && (!/^\d{10}$/.test(value))) {
        showError(field, 'Mobile number must be 10 digits');
        isValid = false;
      }
    });

    if (!isValid) {
      e.preventDefault();
    }
  });

  // Clear error on input
  document.querySelectorAll('input, select').forEach(element => {
    element.addEventListener('input', function () {
      clearError(this.name);
    });
  });

  function showError(field, message) {
    const errorElement = document.getElementById(field + '_error');
    if (errorElement) {
      errorElement.textContent = message;
      errorElement.style.color = 'red';
      errorElement.style.fontSize = '0.9em';
    }
  }

  function clearError(field) {
    const errorElement = document.getElementById(field + '_error');
    if (errorElement) {
      errorElement.textContent = '';
    }
  }

  function clearAllErrors() {
    document.querySelectorAll('.error-message').forEach(element => {
      element.textContent = '';
    });
  }
</script>
{% endblock %}