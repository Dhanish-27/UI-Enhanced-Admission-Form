{% extends 'details_form/Created_base.html' %}

{% block title %}Bank Details{% endblock %}

{% block content %}
{% include "details_form/tracker.html" %}
<div class="col-span-1 lg:col-span-9">
    <!-- Messages -->
    {% if messages %}
    <div class="mb-6 space-y-2">
        {% for message in messages %}
        <div
            class="p-4 rounded-lg text-sm font-medium {% if message.tags == 'error' %}bg-red-50 text-red-600{% elif message.tags == 'success' %}bg-green-50 text-green-600{% else %}bg-blue-50 text-blue-600{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Content Block -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 md:p-8">
        <form method="post" enctype="multipart/form-data" action="{% url 'bank_details' admission.pk %}" id="bankForm">

            {% csrf_token %}
            <input type="hidden" name="pk" value="{% if admission %}{{ admission.pk }}{% endif %}">

            <div class="max-w-5xl mx-auto bg-white shadow-lg rounded-xl p-8">

                <h2 class="text-xl font-semibold mb-6 border-b pb-3">
                    10. Bank Details
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Account Holder Name -->
                    <div>
                        <label class="block font-medium mb-1">Account Holder Name</label>
                        <input type="text" name="account_holder_name"
                            value="{% if admission %}{{ admission.account_holder_name }}{% endif %}"
                            placeholder="Enter name as per bank records"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <span class="error-message" id="account_holder_name_error"></span>
                    </div>

                    <!-- Account Number -->
                    <div>
                        <label class="block font-medium mb-1">Account Number</label>
                        <input type="text" name="account_number"
                            value="{% if admission %}{{ admission.account_number }}{% endif %}"
                            placeholder="Enter bank account number"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <span class="error-message" id="account_number_error"></span>
                    </div>

                    <!-- Bank Name -->
                    <div>
                        <label class="block font-medium mb-1">Bank Name</label>
                        <input type="text" name="bank_name"
                            value="{% if admission %}{{ admission.bank_name }}{% endif %}" placeholder="Enter bank name"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <span class="error-message" id="bank_name_error"></span>
                    </div>

                    <!-- IFSC Code -->
                    <div>
                        <label class="block font-medium mb-1">IFSC Code</label>
                        <input type="text" name="ifsc_code"
                            value="{% if admission %}{{ admission.ifsc_code }}{% endif %}" placeholder="Enter IFSC code"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <span class="error-message" id="ifsc_code_error"></span>
                    </div>

                    <!-- Bank Branch -->
                    <div>
                        <label class="block font-medium mb-1">Bank Branch</label>
                        <input type="text" name="bank_branch"
                            value="{% if admission %}{{ admission.bank_branch }}{% endif %}"
                            placeholder="Enter bank branch"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <span class="error-message" id="bank_branch_error"></span>
                    </div>

                    <!-- Seeding Status -->
                    <div>
                        <label class="block font-medium mb-1">Aadhaar Seeding Status</label>
                        <select name="seeding_status"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Status</option>
                            <option value="Seeded" {% if admission and admission.seeding_status == 'Seeded' %}selected{% endif %}>Seeded</option>
                            <option value="Not Seeded" {% if admission and admission.seeding_status == 'Not Seeded' %}selected{% endif %}>Not Seeded</option>
                            <option value="Pending" {% if admission and admission.seeding_status == 'Pending' %}selected{% endif %}>In Progress / Pending</option>
                        </select>
                        <span class="error-message" id="seeding_status_error"></span>
                    </div>

                </div>

                <!-- Actions -->
                <div class="flex justify-between mt-8">
                    <button type="button" onclick="window.location.href='{% url 'reference_details' admission.pk %}'"
                        class="px-6 py-2 border rounded hover:bg-gray-100">
                        Previous
                    </button>

                    <button type="submit" class="bg-orange-600 text-white px-6 py-2 rounded hover:bg-orange-700">
                        Next
                    </button>
                </div>

            </div>
        </form>

    </div>
</div>

<script>
    document.getElementById('bankForm').addEventListener('submit', function (e) {
        let isValid = true;
        clearAllErrors();

        // Field validation can be added here if specific requirements arise
        // For now, keeping it basic like other forms

        if (!isValid) {
            e.preventDefault();
        }
    });

    // Clear error on input
    document.querySelectorAll('input, select').forEach(element => {
        element.addEventListener('input', function () {
            clearError(this.name);
        });
    });

    function showError(field, message) {
        const errorElement = document.getElementById(field + '_error');
        if (errorElement) {
            errorElement.textContent = message;
            errorElement.style.color = 'red';
            errorElement.style.fontSize = '0.9em';
        }
    }

    function clearError(field) {
        const errorElement = document.getElementById(field + '_error');
        if (errorElement) {
            errorElement.textContent = '';
        }
    }

    function clearAllErrors() {
        document.querySelectorAll('.error-message').forEach(element => {
            element.textContent = '';
        });
    }
</script>
{% endblock %}